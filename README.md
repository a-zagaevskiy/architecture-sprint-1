# 1. Разделение проекта Mesto на несколько микрофронтендов

## 1.1. Особенности текущего проекта

Клиентское приложение написано на React. Код приложения расположен в каталоге frontend/src:
- components - каталог с основными компонентами приложения
- blocks - каталог со стилями
- utils - агрегирует функционал по взаимодействию с API backend'а
- contexts - содержит описание контекстов React (контекст  текущего пользователя) 
- images - векторная графика
- vendor - каталог с 3rd-party стилями

Компоненты:
- App - головной компонент приложения, настраивает взаимодействие всех остальных компонентов
- Main - основной компонент приложения, отвечающий за отображение главной страницы с фотографиями и предоставляющий доступ к основному функционалу приложения
- Card - компонент, отвечающий за отображение одной карточки места
- Register - компонент, отвечающий за форму регистрации нового пользователя
- Login - компонент, отвечающий за аутентификации и авторизации
- остальные компоненты, в основном всплывающие окна для получения пользовательского ввода по основному функционалу (EditAvatarPopup, EditProfilePopup, ImagePopup, AddPlacePopup)

Компоненты App, Main, Card и EditProfilePopup используют глобальное состояние (авторизированный пользователь: CurrentUserContext) - контекст React.
Во время монтирования приложения через глобальное состояние осуществляется работа с JWT-токеном авторизированного пользователя: проверка, установка, сброс - используется localStorage.

Есть три страницы:
1. главная ("/") - отображается компонент Main
    - переход на "/singin" при нажатии кнопки "Выйти"
2. страница аутентификации/авторизации ("/singin") - отображается компонент Login
    - переход на "/signup" по нажатию кнопки "Регистрация" 
    - переход на "/" при успешной авторизации
3. страница регистрации ("/signup") - отображается компонент Register
    - переход на "/signin" при успешной регистрации или при нажатии кнопки "Войти"

## 1.2. Планирование изменений

Существующий монолит можно разделить на три микрофронтенда (модуля):
1. аутентификация/авторизация (auth)
    - форма логина
    - форма регистрации
    - взаимодействие с бекендом:
        + login - аутентификация (получение jwt-токена)
        + register - регистрация нового пользователя
        + checkToken - идентификация по имеющемуся jwt-токену
2. профиль пользователя (profile)
    - верхняя часть страницы с отображением информации о текущем пользователе
    - popup-окна для пользовательского ввода в случае корректировки информации о себе
    - взаимодействие с бекендом:
        + getUserInfo - запрос информации о себе
        + setUserInfo - команда на изменение имени и описания
        + setUserAvatar - команда на изменение аватара
3. работа с карточками мест (cards)
    - верстка списка/каталога мест
    - popup-окно пользовательского ввода информации о новом месте
    - компонент Card
    - взаимодействие с бекендом:
        + getCardsList - запрос списка мест
        + addCard - команда на добавление нового места
        + removeCard - команда на удаление места
        + likeCard - команда на размещение лайка
        + unlikeCard - команда на удаление лайка

Также потребуется создать центральный микрофронтенд (host), который будет отвечать за общую верстку страниц, маршрутизацию в проекте и загрузку нужных модулей.
Чтобы уменьшить связность по контексту авторизированного пользователя между компонентами в разных микрофронтедах, имеет смысл воспользоваться паттерном Pub/Sub, т.е. вместо общего связующего React's Context взаимодействие нужно переписать c использованием шины событий:
* компонент Login из auth будет публиковать jwt токен авторизированного пользователя;
* компоненты profile и cards - слушать событие и загружать jwt токен для реализации логики.

Можно остаться в рамках текущего JS-фреймворка (React), и в качестве инструмента для разбивки монолита использовать Webpack Module Federation.
Использование Single SPA было бы оправдано, если бы появилось требование (или желание/ресурсы) использовать различные JS-фреймворки для написания выделенных микрофронтендов.

Черновик планируемого разбиения с использованием Module Federation представлен в каталоге frontend/microfrontend.
